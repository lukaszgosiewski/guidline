name: GV_demo

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  # Allow manual triggering
  workflow_dispatch:

jobs:
  codeql-analysis:
    name: CodeQL Analysis
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests python-magic-bin

      - name: Create output directory
        run: mkdir -p output

      - name: Run CodeQL Analysis
        run: |
          python wrap.py "$GITHUB_WORKSPACE/testproject" "$GITHUB_WORKSPACE/testproject/script.sh" testrepo" "testbranch" 7a8d32e5b9c01f4e6d8b2c7f9e3a1d0b5c4f2e3a https://auth.demos01.soc.plaxidityx.com/auth/realms/cloud/protocol/openid-connect/token http://cert-c-demo.a.demos01.soc.plaxidityx.com/public-api/guideline/v1/guideline-violations api-demo-user@plaxidityx.com xxx
        env:
          PYTHONUNBUFFERED: 1

      - name: Upload results as artifact
        uses: actions/upload-artifact@v3
        with:
          name: codeql-results
          path: |
            output/results.csv
            output/log.txt